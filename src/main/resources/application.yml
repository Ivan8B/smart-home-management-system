server:
  port: 9080

management:
  endpoints:
    web:
      exposure:
        include: prometheus
      base-path: /
  metrics:
    enable:
      # Эти компоненты экспортируют метрики с ключевым словом name, на которое ругается unified-agent
      executor: false
      cache: false

spring:
  cache:
    cache-names: temperature_cache
    caffeine:
      spec: maximumSize=100,expireAfterWrite=15s

bot:
  # Параметры подключения к чатботу.
  name: ${BOT_NAME}
  token: ${BOT_TOKEN}
  # Пользователи, которые могут писать боту (бот поддерживает только личные диалоги)
  validUserIds: ${BOT_VALID_USER_IDS}
  # Идентификаторы чатов, в которые бот будет слать рассылки
  chatIds: ${BOT_CHAT_IDS}
  # Периодичность запуска таски, которая проверяет статус сессии и пытается переподключиться
  sessionCheckInterval: PT1M

modbus:
  tcpHost: dr302
  tcpPort: 8234
  # Задержка после каждой операции с modbus, иначе устройства не успевают обрабатывать команды
  delay: 50

temperature:
  # Периодичность расчета необходимости отопления в доме
  controlInterval: PT5M
  # Целевая температура в доме (она же температура на улице, при повышении до которой отопление должно отключаться)
  target: 23
  # Отопление отключатся при повышении температуры на улице выше целевой в доме, а включаются при опускании уличной на гистерезис от заданной
  hysteresis: 3
  # Самая холодная расчетная температура на улице
  outsideMin: -30

# Настройки опроса плат опроса датчиков DS18B20, модель R4DCB08
temperatureSensorsBoard:
  # плата 1
  board1:
    # modbus slaveId
    address: 1
  # Настройки регистров температурных сенсоров находятся в enum TemperatureSensorsPresets

# Настройки управления газовым котлом
gasBoiler:
  # Настройки управления реле газового котла
  relay:
    # Modbus slaveId
    address: 2
    # Coil в который пишется значение (F05), нумерация с 0
    coil: 0
    # Периодичность запуска таски управления реле (она фактически включает и выключает реле котла)
    updateInterval: PT15S
    # Падение температуры подачи от максимальной за период при которой котел считается отключившимся
    turnOffDirectDelta: 5
  # Периодичность опроса подачи газового котла (в отопление), чтобы понимать его статус
  direct:
    pollInterval: PT15S
  # Набор температур для расчета целевой температуры обратки для включения газового котла в зависимости от температуры на улице
  temperature:
    # Интервал допустимых температур обработки из которых берется температура для включения котла
    return:
      min: 25
      max: 45
    # Температурный интервал выбранной кривой погодозависимой автоматики котла, сейчас выбрана кривая N22
    weatherCurve:
      min: -20
      max: 17
  # Объем воды проходящий через котел в режиме отопления (м3/ч)
  waterFlow: 1.23

# Настройки управления электрическим котлом
electricBoiler:
  # Настройки управления реле электрического котла
  relay:
    # Modbus slaveId
    address: 3
    # Coil в который пишется значение (F05), нумерация с 0
    coil: 0
  # Периодичность опроса температуры в котельной для управления электрокотлом
  controlInterval: PT5M
  # Электрокотел включается при опускании температуры в котельной меньше минимальной, а отключается при поднятии на гистерезис от минимальной
  hysteresis: 1

# Настройки управления теплым полом
floorHeating:
  # Периодичность опроса контролирующей джобы
  controlInterval: PT10M
  temperature:
    # Минимальная и максимальная температура подачи в теплый пол
    direct:
      min: 30.0
      max: 40.0
    # Коэффициент изолированности, определяет влияние разнцы между целевой температурой в помещении и на улице на целевую температуру подачи
    k: 0.35
  # Настройки клапана подмеса
  valve:
    # Реле управляющее питанием сервопривода клапана
    relay:
      # Modbus slaveId
      address: 4
      # Coil в который пишется значение (F05), нумерация с 0
      coil: 1
      # Время, на которое подается питание на сервопривод (секунд). Не должно быть больше controlInterval!!
      delay: 45
    # Цифро-аналоговый преобразователь
    dac:
      # Modbus slaveId
      address: 5
      # Регистр, в который пишется значение (F06)
      register: 0

# Реле управляющее питанием насосов отопления
heatingPumps:
  relay:
    # Modbus slaveId
    address: 4
    # Coil в который пишется значение (F05), нумерация с 0
    coil: 0

# Настройки управления уличным освещением
streetLight:
  # Настройки реле, управляющего освещением
  relay:
    # Modbus slaveId
    address: 3
    # Coil в который пишется значение (F05), нумерация с 0
    coil: 1
  # Периодичность расчета необходимости освещения
  controlInterval: PT5M
  # Широта и долгота места, для которого рассчитывается время суток
  latitude: ${LATITUDE}
  longitude: ${LONGITUDE}

# Настройки управления обогрева воронок
funnelHeating:
  # Настройки реле, управляющего обогревом
  relay:
    # Modbus slaveId
    address: 2
    # Coil в который пишется значение (F05), нумерация с 0
    coil: 1
  # Периодичность расчета необходимости обогрева
  controlInterval: PT15M
  # Пороговые значения температуры между которыми включается обогрев
  temperature:
    min: -2.0
    max: 2.0

health:
  # Периодиченость опросов селфмониторинга (проверки по аварийным событиям сервиса HealthService и критичных температур)
  controlInterval: PT15M

logging:
  config: classpath:log4j2.yml
